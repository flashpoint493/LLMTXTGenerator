# LLMTXTGenerator 项目 AI 协作开发规则
## LLM Collaboration Protocol v1.0

---

# 一、核心理念

## 1.1 Vibe Development 哲学

> **最珍贵的是对话过程本身，不追求直接出结果，而是步步为营共同规划。**

本项目采用 **Vibe Development** 模式：
- AI 不是执行者，而是**协作伙伴**
- 不急于产出代码，先**对齐理解**
- 每个决策都是**共同思考**的结果
- 对话本身就是**设计过程**的一部分

## 1.2 项目定位

> **LLMTXTGenerator 是生成 llm.txt 的工具，本身也是 llm.txt 的产物**

这是一个**元项目**：
- 我们用 llm.txt 规则来开发生成 llm.txt 的工具
- 每次协作迭代都在验证和完善这套规则
- 本项目的 llm.txt 就是最佳实践样例

---

# 二、职能角色定义

| 角色代号 | 职能 | 关注点 | 触发词 |
|---------|------|--------|--------|
| `[DESIGN]` | 协议设计 | Schema、流程、扩展机制 | "设计"、"协议"、"Schema" |
| `[ARCH]` | 架构 | 包结构、CLI、生成器 | "架构"、"重构"、"模块" |
| `[DEV]` | 开发 | 具体实现、Bug修复 | "开发"、"实现"、"代码" |
| `[PM]` | 项目管理 | 里程碑、优先级、发布 | "规划"、"发布"、"PyPI" |
| `[QA]` | 质量保证 | 测试、验证 | "测试"、"验证" |

---

# 三、决策分级制度

| 等级 | 类型 | 影响范围 | Review 要求 |
|-----|------|---------|------------|
| **S** | 战略决策 | 协议设计、核心概念 | 必须人工确认 |
| **A** | 架构决策 | Schema结构、扩展机制 | 人工Review |
| **B** | 实现决策 | 具体实现方案 | 可快速确认 |
| **C** | 细节决策 | 命名、格式 | AI自主决策 |

---

# 四、扩展机制设计（重要）

## 4.1 扩展的本质

> **扩展 = 流程钩子 + 上下文注入 + 引用文档**

扩展不是静态配置，而是在特定流程节点注入上下文：

```yaml
extension:
  # 钩子定义：在什么时机触发
  hooks:
    - trigger: "qa.list_test_cases"      # QA 列出测试用例时
      inject: "gm_commands"               # 注入 GM 命令上下文
      condition: "project.has_gm_console" # 触发条件
    
    - trigger: "dev.feature_complete"    # 功能开发完成时
      inject: "gm_test_template"         # 注入 GM 测试模板
  
  # 上下文定义：注入什么内容
  contexts:
    gm_commands:
      type: "reference"                  # 引用类型
      source: "docs/GM_COMMANDS.md"      # 引用文档
      inline_if_short: true              # 内容短则内联
    
    gm_test_template:
      type: "template"                   # 模板类型
      content: |
        ## 🎮 GM 快速测试
        可用命令: {gm_commands}
```

## 4.2 钩子触发点

| 触发点 | 时机 | 可注入内容 |
|-------|------|-----------|
| `dialogue.start` | 对话开始 | 领域特定上下文 |
| `dialogue.end` | 对话结束 | 额外更新文件 |
| `qa.list_test_cases` | QA 列测试用例 | 测试辅助工具 |
| `dev.feature_complete` | 功能完成 | 验收模板 |
| `build.pre` | 构建前 | 构建检查项 |
| `build.post` | 构建后 | 部署指引 |

## 4.3 上下文类型

| 类型 | 说明 | 示例 |
|-----|------|------|
| `reference` | 引用外部文档 | `source: "docs/GM.md"` |
| `template` | 内联模板 | `content: "..."` |
| `computed` | 动态计算 | `from: "project.roles"` |

## 4.4 引用文档规范

当扩展内容较多时，使用引用而非内联：

```yaml
contexts:
  large_content:
    type: "reference"
    source: "docs/DOMAIN_SPECIFIC.md"
    section: "## GM Commands"  # 可选：只引用特定章节
```

---

# 五、开发流程

## 5.1 对话开始时（强制）

```
1. 读取 llm.txt → 了解协作规则
2. 读取 docs/CONTEXT.md → 恢复当前状态
3. 确认用户本次对话目标
```

## 5.2 对话结束时（强制）

```
1. 更新 docs/CONTEXT.md → 保存进度
2. 更新 docs/CHANGELOG.md → 记录产出
3. Git commit → 记录对话成果
```

---

# 六、Git 协作规范

### Commit 前缀
```
[DESIGN]  协议/Schema 设计变更
[ARCH]    架构调整
[FEAT]    新功能
[FIX]     Bug修复
[REFACTOR] 重构
[DOC]     文档更新
[TEST]    测试相关
```

---

# 七、关键文件

| 文件 | 职责 | 更新时机 |
|-----|------|---------|
| `llm.txt` | 本项目协作规则 | 协作方式演进时 |
| `docs/CONTEXT.md` | 当前开发上下文 | 每次对话结束 |
| `docs/CHANGELOG.md` | 变更日志 | 每次有效对话 |
| `schema/project.schema.yaml` | 配置Schema定义 | Schema变更时 |
| `src/llmtxt/` | 核心代码 | 功能开发时 |

---

# 八、快速参考

## 开始对话
```
继续 LLMTXTGenerator 开发。
请先读取 llm.txt 和 docs/CONTEXT.md。
本次目标: {目标}
```

## 结束对话
```
请更新 CONTEXT.md，总结产出，git commit。
```

---

*本项目是 llm.txt 的元实现，我们用 llm.txt 来开发 llm.txt 生成器。*
